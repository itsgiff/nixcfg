# NixOS/macOS Unified Configuration Implementation Plan

This document outlines the step-by-step implementation plan for the unified configuration across NixOS and macOS systems.

## Current Status Overview

- âœ… NixOS configurations for x1 and nuc are complete and operational
- âœ… Home Manager configurations for paul and admin users are working
- âœ… Core feature modules implemented (git, fish, vscode, fastfetch, etc.)
- âœ… Specialized modules for NixOS are working (docker, nfs, nvidia)
- âœ… Bootstrap script (nixinit.sh) created for easy machine setup
- âœ… macOS/nix-darwin integration is complete and operational
- ðŸŸ¡ Feature module refinement is ongoing
- ðŸ”œ Secret management implementation planned

## Phase 1: SETUP & NIXOS âœ… COMPLETED

### Repository Initialization
- âœ… Create initial repository structure
- âœ… Set up basic flake.nix with inputs
- âœ… Initialize git repository
- âœ… Add LICENSE and README.md

### NixOS Configuration (x1)
- âœ… Create initial system configuration
- âœ… Set up Home Manager integration
- âœ… Configure system packages and services
- âœ… Test and validate core functionality
- âœ… Add user-specific configurations

### NixOS Configuration (nuc)
- âœ… Create system configuration with appropriate hardware settings
- âœ… Set up admin user with Home Manager
- âœ… Configure Docker with NVIDIA support
- âœ… Set up NFS mounts and SSH configuration
- âœ… Test and validate server functionality

### Bootstrap Script
- âœ… Create nixinit.sh bootstrap script
- âœ… Add hostname validation and configuration
- âœ… Add repository cloning and setup
- âœ… Add flake configuration application
- âœ… Test script functionality across different hosts

## Phase 2: MACOS INTEGRATION âœ… COMPLETED

### nix-darwin Setup
- âœ… Install nix-darwin on macOS
- âœ… Create basic configuration.nix for macOS
- âœ… Set up compatibility with NixOS 24.11
- âœ… Set up macOS-specific preferences

### Home Manager for macOS
- âœ… Configure Home Manager for paul@macbook
- âœ… Fix PATH issues for darwin-rebuild and home-manager
- âœ… Configure macOS-specific shell environment
- âœ… Test cross-platform Home Manager modules

### Integration Testing
- âœ… Test unified configuration across all systems
- âœ… Verify feature modules work on macOS
- âœ… Ensure smooth updates and rebuilds

## Phase 3: REFINEMENT ðŸŸ¡ IN PROGRESS

### Feature Module Development
- âœ… Create initial modules for common applications (git, vscode, etc.)
- ðŸŸ¡ Refine existing modules for better cross-platform compatibility
- ðŸŸ¡ Add more application-specific configurations
- ðŸŸ¡ Implement conditional configurations for different platforms

### Homebrew Integration
- âœ… Set up basic Homebrew module structure
- âœ… Configure initial Homebrew package list
- âœ… Set up Mac App Store (mas) integration scaffold
- ðŸ”œ Finalize and optimize Homebrew/mas integration

### Secret Management
- ðŸ”œ Set up sops-nix for encrypted secrets
- ðŸ”œ Create secure SSH and GPG key configuration
- ðŸ”œ Manage sensitive data safely across systems

## Implementation Details

### Bootstrap Script Implementation
1. âœ… Create scripts directory in repository
2. âœ… Develop nixinit.sh with the following features:
   - Hostname validation (x1, nuc, macbook only)
   - Configuration file backups
   - Git installation and repository cloning
   - Flake experimental features enablement
   - System configuration application
   - Special handling for the nuc's Docker setup
   - Optional fish shell enhancements
3. âœ… Create one-liner for easy script execution
4. âœ… Test script on different host types

### macOS Integration Steps
1. âœ… Install nix-darwin on macBook
2. âœ… Create initial configuration.nix for macbook (basic system preferences)
3. âœ… Add darwin configuration to flake.nix
4. âœ… Test initial darwin-rebuild switch
5. âœ… Configure Home Manager for paul@macbook
6. âœ… Ensure PATH integration for system commands
7. âœ… Test cross-platform modules
8. âœ… Create macOS modules (defaults.nix, desktop.nix, homebrew.nix)
9. âœ… Document macOS-specific modules

### Feature Module Roadmap
1. âœ… Review and refine existing modules (git, fish, vscode, fastfetch)
2. ðŸŸ¡ Create platform-specific versions of any incompatible configurations
3. ðŸŸ¡ Add additional application configurations:
   - Browser configurations (Firefox, Chrome)
   - Terminal emulators
   - Development environments
   - Media applications
4. ðŸŸ¡ Implement conditional platform detection and configuration

### Secret Management Approach
1. ðŸ”œ Install and configure sops-nix
2. ðŸ”œ Create encrypted secrets directory
3. ðŸ”œ Store SSH keys, API tokens, and other sensitive data
4. ðŸ”œ Set up automatic decryption during system activation

## Next Actions
1. âœ… Complete macOS/nix-darwin configuration
2. âœ… Test Home Manager modules on macOS
3. ðŸŸ¡ Refine feature modules for better cross-platform compatibility
4. ðŸŸ¡ Finalize Homebrew integration for macOS
5. ðŸ”œ Implement secret management
6. ðŸ”œ Document system management workflows